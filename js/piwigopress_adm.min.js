(function(a){a.fn.extend({insertAtCaret:function(b){return this.each(function(e){if(document.selection){this.focus();sel=document.selection.createRange();sel.text=b;this.focus()}else{if(this.selectionStart||this.selectionStart=="0"){var d=this.selectionStart;var c=this.selectionEnd;var f=this.scrollTop;this.value=this.value.substring(0,d)+b+this.value.substring(c,this.value.length);this.focus();this.selectionStart=d+b.length;this.selectionEnd=d+b.length;this.scrollTop=f}else{this.value+=b;this.focus()}}})}});a(document).ready(function(){var b=true;a("a#PWGP_button").unbind().click(function(){if(b){if(a("#dashboard-widgets-wrap").size()==0){var c="#poststuff"}else{var c="#dashboard-widgets-wrap"}if(a("#PWGP_shortcoder").size()==0){var d=a("#PWGP_Gal_finder").html();a(c).before('<div id="PWGP_shortcoder" />');a("#PWGP_shortcoder").html(d);a("#PWGP_Gal_finder").remove()}else{a("#PWGP_shortcoder").show()}a("#PWGP_catscroll").on("focus",function(){current_catid=this.value}).change(function(){if(current_catid!=this.value){a("#PWGP_more").hide();a("#PWGP_hide").hide();a("#PWGP_show").hide();a("#PWGP_show_stats").hide()}});a("#PWGP_finder").focus(function(){current_url=this.value}).change(function(){if(current_url!=this.value){a("#PWGP_more").hide();a("#PWGP_hide").hide();a("#PWGP_show").hide();a("#PWGP_show_stats").hide();a("#PWGP_catscroll").hide();a("#PWGP_loadcat").show();a("#PWGP_catscroll").val(0)}});a("#PWGP_loadcat").unbind().click(function(){var e=a("#PWGP_finder").val();a("#PWGP_Load_Active").show();a.ajax({url:"../wp-content/plugins/piwigopress/thumbnails_reloader.php?&loadcats=1&url="+e,cache:false,success:function(j){var j=jQuery.parseJSON(j);var h=a("#PWGP_catscroll");a('#PWGP_catscroll option[value!="0"]').remove();if(j.stat=="ok"){var g=j.result.categories;for(var l=0;l<g.length;l++){var f=g[l].name;var k=g[l].id;h.append("<option value="+k+">"+f+"</option>")}h.select();h.focus()}},error:function(g,h,f){console.log("cannot load list of piwigo categories: "+h+" "+f+" "+g.responseText)}});a("#PWGP_Load_Active").hide();a("#PWGP_loadcat").hide();a("#PWGP_catscroll").show()});a("#PWGP_load").unbind().click(function(){var j=a("#PWGP_finder").val(),h=5,f=a("#PWGP_dragger"),k=a("#PWGP_dragger li"),e=a("#PWGP_dropping");a(".PWGP_system").show(500);a("#PWGP_Load_Active").show();var g=a("#PWGP_catscroll").val();if(!g){g=0}f.load("../wp-content/plugins/piwigopress/thumbnails_reloader.php?&url="+j+"&category="+g,function(){a("#PWGP_more").show().unbind().click(function(){l()});a("#PWGP_hide").show().unbind().click(function(){var o=Math.max(1,Math.floor(a("li:visible",f).size()/2));for(i=0;i<o;i++){f.find("li:visible").first().hide()}if(a("li:visible",f).size()==0){a("#PWGP_hide").hide()}else{a("#PWGP_show").show().unbind().click(function(){a("li:hidden",f).show();a("#PWGP_show").hide()})}});n();a("#PWGP_Load_Active").hide();function l(){a("#PWGP_Load_Active").show();g=a("#PWGP_catscroll").val();if(!g){g=0}a.ajax({url:"../wp-content/plugins/piwigopress/thumbnails_reloader.php?&loaded="+h+"&url="+j+"&category="+g+"&recursive=1",cache:false,success:function(p){n(p)}});var o=5;if(h>9){o=10}if(h>49){o=50}if(h>99){o=100}h+=o}function n(o){a(f).append(o);var q=(a("#PWGP_dragger img").first().height())+20;f.height(q);e.height(q+25).css("min-height",q+25);a("#PWGP_dropping ul").height(q);a("li",f).draggable({revert:true,cursor:"move",zIndex:50});var p=a("li",e).size()+a("li",f).size();a("#PWGP_show_stats").show().find("#PWGP_stats").text(" "+p+" / "+h);e.droppable({activeClass:"ui-state-highlight",drop:function(r,s){m(s.draggable)}});if(a("li:visible",f).size()>0){a("#PWGP_hide").show()}a("#PWGP_Load_Active").hide()}function m(o){o.fadeOut(function(){var p=a("ul",e);o.appendTo(p).fadeIn();a("a#PWGP_Gen").unbind().click(function(){var q=window.tinyMCE.majorVersion;a("img",e).each(function(){var s=a(this).attr("title").split("]");var r=s[0];var w=a("#thumbnail_size input[type=radio][name=thumbnail_size]:checked").attr("value");if(w!=="la"){r+=" size='"+w+"'"}a("input#desc_check[name=desc_check]").attr("value",0);$hdesc=0+a("input#desc_check[name=desc_check]:checked").attr("value",1).attr("value");if($hdesc==1){r+=" desc=1"}var u=a("#photo_class").val();if(u!=""){r+=" class='"+u+"'"}var t=a("#link_type input[type=radio][name=link_type]:checked").attr("value");if(t!="picture"){r+=" lnktype='"+t+"'"}var v=a("#open_type input[type=radio][name=open_type]:checked").attr("value");if(v!=""){r+=" opntype='"+v+"'"}var r="\t"+r+"] \n\r";a("#content").insertAtCaret(r);if(q>="4"){tinyMCE.execCommand("mceInsertContent",false,r)}else{tinyMCE.execInstanceCommand("content","mceInsertContent",false,r)}})});a("a#PWGP_rst").unbind().click(function(){a("li",e).appendTo(f);a("a#PWGP_Gen").hide();a("a#PWGP_rst").hide();a("#PWGP_show_stats").show().find("#PWGP_stats").text(" "+a("li",f).size()+" / "+h)})});a("a#PWGP_Gen").show();a("a#PWGP_rst").show()}})});b=false}else{a("div#PWGP_shortcoder").hide();b=true}})})}(jQuery));